<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: profile/profile.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: profile/profile.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getData } from "../mjs/getData.mjs";
import { newPostValuesToObject, newPostToApiFunksjon, isMediaValid, processCommentsForPost, processReactionsForPost, searchElement } from "../mjs/helpers.mjs";

const token = localStorage.getItem("accessToken");
const mainApiUrl = "https://api.noroff.dev/api/v1";
//const getMyPosts = `${mainApiUrl}/social/profiles/:name/posts`;
// const postsUrl = `${mainApiUrl}/social/posts`;
const myName = localStorage.getItem("name");
const getMyPosts = `${mainApiUrl}/social/profiles/${myName}/posts`;
const myPostsUrl = `${mainApiUrl}/social/posts`;
let profilePosts = undefined;
let postIdEdit = undefined;

const requestParam = {
    _author: true,
    _comments: true,
    _reactions: true
    // offset: 100
};

const queryString = new URLSearchParams(requestParam).toString();

window.onload = fetchPostsFromApi();

/** 
 * This function 
 * 
 * @param {array} posts posts from API
 */
function renderPage(posts) {
    showMyPosts(posts);
    showComments();
    showReactions();
    showEdit();
    showDelete();
}


/** 
* This function gets posts from API and send them to next function that shows them on the site
*/
async function fetchPostsFromApi() {
    profilePosts = await getData(`${getMyPosts}?${queryString}`);
    renderPage(profilePosts);
}

//This event listener open the module that enables to write a new post by taking the values of a title, message(body) and media; it also starts functions get those values and send them to API
const formPost = document.getElementById("formPost");
document.getElementById("postBtn").addEventListener("click", (event) => {
    event.preventDefault();

    const titlePost = formPost.elements[0];
    const messagePost = formPost.elements[1];
    const mediaPost = formPost.elements[2];

    const userTitlePost = titlePost.value;
    const userMessagePost = messagePost.value;
    const userMediaPost = mediaPost.value;

    const newPost = newPostValuesToObject(userTitlePost, userMessagePost, userMediaPost);
    newPostToApiFunksjon(postsUrl, newPost);
});


/**
 * This function gets and shows my posts sent from API; it also checks if there is any media included and start functions that enable to show comments and reactions if the buttons are pressed
 * @param {array} posts posts from API
*/
function showMyPosts(posts) {
    let containerHTMLCard = document.getElementById("singleCardProfile");
    //Clear the page
    containerHTMLCard.innerHTML = "";
    let setImg = "";
    for (var i = 0; i &lt; posts.length; i++) {
        let formattedDate = new Date(posts[i].updated).toLocaleDateString();
        let formattedTime = new Date(posts[i].updated).toLocaleTimeString();
        if (isMediaValid(posts[i].media)) {
            setImg = posts[i].media;
        } else {
            setImg = "../pics/jean-marc-vieregge-cDKqFb-NOZc-unsplash.jpg";
        }

        containerHTMLCard.innerHTML += `
        &lt;div class="my-2 col col-lg-10 w-100">
            &lt;div class="card shadow-sm"> 
                &lt;img src="${setImg}" alt="Hanks of wool" class="bd-placeholder-img card-img-top" id="cardPicture">
                &lt;h5 class="card-title" id="cardTitle">${posts[i].title}&lt;/h5>
                &lt;div class="card-body">
                    &lt;p class="card-text text-start" id="cardBody">${posts[i].body}&lt;/p>
                    &lt;div class="d-flex justify-content-between align-items-center">
                        &lt;div class="btn-group">
                            &lt;button type="button" class="btn btn-sm btn-secondary" id="btnShowComments${posts[i].id}" data-postid="${posts[i].id}">Comments&lt;/button>
                            &lt;button type="button" class="btn btn-sm btn-secondary" id="btnShowReactions${posts[i].id}" data-postid="${posts[i].id}">Reactions&lt;/button>
                            &lt;button type="button" class="btn btn-sm btn-secondary" id="btnEdit${posts[i].id}" data-postid="${posts[i].id}">Edit&lt;/button>
                            &lt;button type="button" class="btn btn-sm btn-secondary" id="btnDelete${posts[i].id}" data-postid="${posts[i].id}">Delete&lt;/button>
                        &lt;/div>
                        &lt;small class="text-muted" id="cardUpdated">${formattedDate} ${formattedTime}&lt;/small> 
                    &lt;/div>
                &lt;/div>
                &lt;div class="showComments" id="showComments${posts[i].id}" style="display:none;">${processCommentsForPost(posts[i].comments)}&lt;/div>
                &lt;div class="showReactions" id="showReactions${posts[i].id}" style="display:none;">${processReactionsForPost(posts[i].reactions)}&lt;/div>
            &lt;/div>
        &lt;/div>        
        `;

    }
}


/**
 * This function deletes the post
 * 
 * @param {number} id 
 */
async function deletePost(id) {
    const deletePost = {
        method: "DELETE",
        headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
        },
    };
    try {
        await fetch(`${myPostsUrl}/${id}`, deletePost);
    } catch (error) {
        console.log(error);
    }
}


/**
 * This function shows the modal and fills the modal post with post's details
 * 
 * @param {number} id 
 */
function editPost(id) {
    const editPostModal = document.getElementById("editPostModal");
    var myModal = new bootstrap.Modal(editPostModal, {
        backdrop: 'static', // You can set the backdrop behavior (static or true/false)
        keyboard: false,    // You can control whether the modal can be closed with the keyboard
        focus: true
    })
    const tmp = profilePosts.find(x => x.id == id);
    document.getElementById("exampleFormControlTextarea6").value = tmp.title;
    document.getElementById("exampleFormControlTextarea7").value = tmp.body;
    document.getElementById("exampleFormControlTextarea8").value = tmp.media;
    postIdEdit = id;
    myModal.show();
}


//This event listener open the module that enables to edit a post by taking the values of a title, message(body) and media; it also starts functions get those values and send them to API
document.getElementById("editPostBtn").addEventListener("click", async (event) => {
    event.preventDefault();

    const titlePost = formEditPost.elements[0];
    const messagePost = formEditPost.elements[1];
    const mediaPost = formEditPost.elements[2];

    const userTitlePost = titlePost.value;
    const userMessagePost = messagePost.value;
    const userMediaPost = mediaPost.value;

    const editedPost = editedPostValuesToObject(userTitlePost, userMessagePost, userMediaPost);
    await editedPostToApiFunksjon(`${myPostsUrl}/${postIdEdit}`, editedPost);
    postIdEdit = undefined;
    await fetchPostsFromApi();
    renderPage(profilePosts);
});


/** 
 * This function puts the values of a title, message(body) and media in an object
 * 
 * @param {string} title 
 * @param {string} message 
 * @param {string} media 
 * @returns {object} object with key-value pairs of title, message(body) and media
 */
function editedPostValuesToObject(title, message, media) {
    const postToApi = {
        "title": title,
        "body": message,
        "media": media
    };
    return postToApi;
}


/** 
 * This function sends a created object (and assigned token) to API and replace the old one
 * 
 * @param {string} url 
 * @param {object} post 
 */
async function editedPostToApiFunksjon(url, post) {
    try {
        const token = localStorage.getItem("accessToken");
        const postData = {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(post),
        };
        let response = await fetch(url, postData);
        await response.json();
    } catch (error) {
        console.log(error)
    }
}


/** 
 * This functions shows the post's comments or a message that there are none after the button is pressed
 */
function showComments() {
    const commentBtns = document.querySelectorAll('[id^="btnShowComments"]');
    commentBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
            document.getElementById(`showComments${btn.dataset.postid}`).style.display = "block";
        })
    })
}

/** 
 * This functions shows the post's reactions or a message that there are none after the button is pressed
 */
function showReactions() {
    const reactionsBtns = document.querySelectorAll('[id^="btnShowReactions"]');
    reactionsBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
            document.getElementById(`showReactions${btn.dataset.postid}`).style.display = "block";
        })
    })
}
/**
 * This function adds event listener to edit button in all posts
 */
function showEdit() {
    const editBtns = document.querySelectorAll('[id^="btnEdit"]');
    for (let i = 0; i &lt; editBtns.length; i++) {
        const editBtn = editBtns[i];
        editBtn.addEventListener("click", function () {
            const postId = editBtn.dataset.postid;
            editPost(postId);
        });
    }
}


/**
 * This function adds event listener to delete button in all posts
 */
function showDelete() {
    const deleteBtns = document.querySelectorAll('[id^="btnDelete"]');
    for (let i = 0; i &lt; deleteBtns.length; i++) {
        const deleteBtn = deleteBtns[i];
        deleteBtn.addEventListener("click", async function () {
            const postId = deleteBtn.dataset.postid;
            await deletePost(postId);
            await fetchPostsFromApi();
            renderPage(profilePosts);
        });
    }
}

// This event listener sends search value from search field when Enter is pressed to a function that will check it
const searchField = document.getElementById("searchInput");
searchField.addEventListener("keydown", (event) => {

    if (event.key === "Enter") {

        const result = searchElement(profilePosts, searchField.value);
        renderPage(result);
    }
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#deletePost">deletePost</a></li><li><a href="global.html#editPost">editPost</a></li><li><a href="global.html#editedPostToApiFunksjon">editedPostToApiFunksjon</a></li><li><a href="global.html#editedPostValuesToObject">editedPostValuesToObject</a></li><li><a href="global.html#fetchPostsFromApi">fetchPostsFromApi</a></li><li><a href="global.html#logInUser">logInUser</a></li><li><a href="global.html#registerUser">registerUser</a></li><li><a href="global.html#renderPage">renderPage</a></li><li><a href="global.html#showComments">showComments</a></li><li><a href="global.html#showDelete">showDelete</a></li><li><a href="global.html#showEdit">showEdit</a></li><li><a href="global.html#showMyPosts">showMyPosts</a></li><li><a href="global.html#showPosts">showPosts</a></li><li><a href="global.html#showReactions">showReactions</a></li><li><a href="global.html#userToLogInFunksjon">userToLogInFunksjon</a></li><li><a href="global.html#userToRegisterFunksjon">userToRegisterFunksjon</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Oct 15 2023 11:51:22 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
